{% set all_media = bestor('media_info', element['#object'], field_name, {'image_style': 'paragraph_media'}) %}

{% if all_media|length == 1 %}
  {# Single item #}
  {% set media_info = all_media|first %}
  
  {% set media %}
    <img loading="lazy" src="{{ media_info.url }}" alt="{{ media_info.alt }}">
  {% endset %}
  
  {{ include('jakarta:c-media-1-item', {
    media: media,
    media_uri: element['#object'].field_lightbox.value ? media_info.original_url : null,
    caption: element['#object'].field_caption.value ? element['#object'].field_title.value : null,
    add_lightbox: element['#object'].field_lightbox.value,
    attr_variant: element['#object'].field_caption.value ? 'media_w_caption' : 'media_only',
  }, with_context = false) }}

{% elseif all_media|length > 1 %}
  {# Gallery #}
  {% set gallery_items = [] %}
  {% set all_thumbs = bestor('media_info', element['#object'], field_name, {
    'image_style': 'thumbnail',
  }) %}

  {% for media_info in all_media %}
    {% set gallery_items = gallery_items|merge([{
      'display_url': media_info.url,
      'lightbox_url': media_info.original_url,
      'thumb_url': all_thumbs[loop.index0].url,
      'alt': media_info.alt,
      'caption': element['#object'].field_caption.value ? element['#object'].field_title.value : null,
    }]) %}
  {% endfor %}
  
  {{ include('bestor:c-media-gallery', {
    gallery_id: 'gallery-' ~ element['#object'].id(),
    items: gallery_items,
    caption: element['#object'].field_caption.value
      ? element['#object'].field_title.value
      : null,
  }, with_context = false) }}

{% endif %}