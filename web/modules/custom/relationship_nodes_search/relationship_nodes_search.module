<?php

use Drupal\Core\Entity\EntityTypeInterface;
use Drupal\relationship_nodes_search\Form\ExtendedIndexAddFieldsForm;
use Drupal\search_api\Query\QueryInterface;
use Drupal\relationship_nodes_search\Processor\RelationProcessorProperty;
use Drupal\relationship_nodes_search\SearchAPI\Query\NestedFacetParamBuilder; 


function relationship_nodes_search_module_implements_alter(&$implementations, $hook) {
  if ($hook === 'search_api_query_alter') {
    if (isset($implementations['relationship_nodes_search'])) {
      $implementation = $implementations['relationship_nodes_search'];
      unset($implementations['relationship_nodes_search']);
      $implementations['relationship_nodes_search'] = $implementation;
    }
  }
}


function relationship_nodes_search_theme() {
  return [
    'relationship_field' => [
      'variables' => [
        'relationships' => [],
        'grouped' => [],
        'summary' => [],
        'fields' => [],
        'row' => NULL,
      ],
      'template' => 'relationship-field',
    ],
  ];
}


function relationship_nodes_search_entity_type_alter(array &$entity_types) {
  if (isset($entity_types['search_api_index'])) {
    $entity_types['search_api_index']->setFormClass('add_fields', ExtendedIndexAddFieldsForm::class);
  }
}


function relationship_nodes_search_search_api_field_type_mapping_alter(array &$mapping) {
 $mapping['relation_info'] = 'relationship_nodes_search_nested_relationship';
}
  

function relationship_nodes_search_facets_search_api_query_type_mapping_alter($backend_plugin_id, array &$query_types){
  $query_types['relationship_nodes_search_nested_relationship'] = 'search_api_nested';
}