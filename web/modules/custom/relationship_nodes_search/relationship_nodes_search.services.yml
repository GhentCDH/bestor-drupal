services:
  relationship_nodes_search.nested_relationship_mapping_subscriber:
    class: Drupal\relationship_nodes_search\EventSubscriber\NestedRelationshipMappingSubscriber
    arguments:
      - '@entity_field.manager'
    tags:
      - { name: event_subscriber }
  relationship_nodes_search.reindex_targets_on_relation_update:
    class: Drupal\relationship_nodes_search\EventSubscriber\ReindexTargetsOnRelationUpdate
    arguments:
      - '@entity_type.manager'
      - '@relationship_nodes.relation_bundle_settings_manager'
      - '@relationship_nodes.relation_node_info_service'
    tags:
      - { name: event_subscriber }
  relationship_nodes_search.relation_search_service:
    class: Drupal\relationship_nodes_search\Service\RelationSearchService
    arguments:
      - '@entity_type.manager'
      - '@entity_field.manager'
      - '@logger.factory'
      - '@cache.default'
      - '@relationship_nodes.field_name_resolver'
  relationship_nodes_search.nested_filter_builder:
    class: Drupal\relationship_nodes_search\SearchAPI\Query\NestedFilterBuilder
    decorates: elasticsearch_connector.query_filter_builder
    arguments: 
      - '@logger.channel.elasticsearch_connector'
      - '@relationship_nodes_search.relation_search_service' 
  relationship_nodes_search.nested_facet_builder:
    class: Drupal\relationship_nodes_search\SearchAPI\Query\NestedFacetParamBuilder
    decorates: elasticsearch_connector.facet_builder
    arguments:
      - '@logger.channel.elasticsearch_connector'
      - '@relationship_nodes_search.nested_aggregation_service'
      - '@relationship_nodes_search.relation_search_service'
  relationship_nodes_search.nested_aggregation_service:
    class: Drupal\relationship_nodes_search\Service\NestedAggregationService
    arguments:
      - '@relationship_nodes_search.relation_search_service'
  