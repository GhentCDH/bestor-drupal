<?php

/**
 * @file
 * Main module file for Bestor Nodes Helper.
 */

use Drupal\node\NodeInterface;

/**
 * Implements hook_node_presave().
 */
function bestor_nodes_helper_node_presave(NodeInterface $node) {
  // Zorg dat default translation altijd een titel heeft
  \Drupal::service('bestor_nodes_helper.node_language_analyzer')
    ->ensureDefaultTranslationTitle($node);
}

/**
 * Implements hook_node_view().
 */
/*
function bestor_nodes_helper_node_view(array &$build, NodeInterface $node, $view_mode, $langcode) {
  // Alleen voor full view mode
  if ($view_mode !== 'full') {
    return;
  }

  $analyzer = \Drupal::service('bestor_nodes_helper.node_language_analyzer');
  $current_lang = \Drupal::languageManager()->getCurrentLanguage()->getId();
  
  // Check of er betere vertalingen zijn
  $suggestions = $analyzer->getTranslationSuggestions($node, $current_lang);
  
  if (!$suggestions) {
    return; // Vertaling is OK
  }

  // Bouw waarschuwing
  $links = [];
  foreach ($suggestions['alternatives'] as $langcode => $alt) {
    $links[] = sprintf(
      '<a href="%s">%s</a> (%d woorden)',
      $alt['url'],
      $alt['language_name'],
      $alt['word_count']
    );
  }
  
  $message = sprintf(
    '<strong>Deze vertaling is beperkt (%d woorden).</strong><br>Voor meer volledige informatie, zie:<ul><li>%s</li></ul>',
    $suggestions['current_words'],
    implode('</li><li>', $links)
  );

  $build['translation_alert'] = [
    '#type' => 'container',
    '#weight' => -100,
    '#attributes' => ['class' => ['translation-alert', 'translation-alert--incomplete']],
    'message' => [
      '#markup' => $message,
    ],
    '#attached' => [
      'library' => ['bestor_nodes_helper/translation_alert'],
    ],
  ];
}*/